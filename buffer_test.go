package geoos

import (
	"testing"

	"github.com/spatial-go/geoos/algorithm/buffer"
	"github.com/spatial-go/geoos/algorithm/matrix"
)

func TestGeoosBuffer(t *testing.T) {
	type args struct {
		geom     matrix.Steric
		distance float64
		quadsegs int
	}
	tests := []struct {
		name string
		args args
		want matrix.Steric
	}{
		{name: "line buffer1", args: args{
			geom:     matrix.LineMatrix{{12925610.710013045, 4856270.465739663}, {12925562.342807498, 4856370.568506251}, {12925554.8522816, 4856387.370610655}},
			distance: 10,
			quadsegs: 8,
		}, want: matrix.PolygonMatrix{

			{{12925553.33876128, 4856366.217971605}, {12925545.718796838, 4856383.29882283}, {12925545.099927789, 4856385.158915575}, {
				12925544.855836228, 4856387.104002521}, {12925544.995902454, 4856389.059335069}, {12925545.514743807, 4856390.949770884}, {12925546.392421499, 4856392.702661579}, {
				12925547.59520687, 4856394.250644547}, {12925549.076877553, 4856395.534231671}, {12925550.780493775, 4856396.504095417}, {12925552.64058652, 4856397.122964467}, {
				12925554.585673466, 4856397.367056029}, {12925556.541006014, 4856397.2269898}, {12925558.431441829, 4856396.70814845},
				{12925560.184332523, 4856395.830470758}, {12925561.732315492, 4856394.627685386}, {12925563.015902616, 4856393.1460147025}, {12925563.985766362, 4856391.44239848},
				{12925571.47629226, 4856374.640294076},
				{12925619.714059263, 4856274.816274309}, {12925620.389796244, 4856272.976077729}, {12925620.693544587, 4856271.039410265}, {12925620.61363141, 4856269.080696963}, {12925620.153127734, 4856267.175210074},
				{12925619.329730455, 4856265.396176391}, {12925618.175082272, 4856263.811963183}, {12925616.733555663, 4856262.483450873}, {12925615.06054769, 4856261.461693445},
				{12925613.220351111, 4856260.785956463}, {12925611.283683648, 4856260.482208122}, {12925609.324970344, 4856260.562121298}, {12925607.419483457, 4856261.022624974}, {12925605.640449774, 4856261.846022252},
				{12925604.056236565, 4856263.000670436}, {12925602.727724256, 4856264.442197044}, {12925601.705966827, 4856266.115205017}, {12925553.33876128, 4856366.217971605}},
		},
		},
	}
	for _, tt := range tests {
		if !GeoosTestTag && tt.name != "line buffer1" {
			continue
		}
		t.Run(tt.name, func(t *testing.T) {
			if got := buffer.Buffer(tt.args.geom, tt.args.distance, tt.args.quadsegs); !GeoosTestTag || got == nil || !got.EqualsExact(tt.want, 0.01) {
				t.Errorf("Buffer() = %v,\n want %v", got, tt.want)
			}
		})
	}
}
